I"f<p>I have a dumbphone. And it’s great, except when I’m lost. Most people open Google Maps on their phone, check out their location on the map, and course correct. I usually drive/hike/bike for another 15 minutes, then call one of my other dumbphone friends and ask them to look things up for me.
<br />
<br />
I’d been meaning to try <a href="https://aws.amazon.com/lambda/">AWS Lambda</a> for some time, and this seemed like a good application. AWS Lambda provides serverless computing infrastructure– you upload your code to the AWS servers, it waits for you to trigger it, and you only pay for it when it’s in use. Plus it’s totally scalable, so when this “app” takes over the dumbphone world, it should remain responsive.
<br />
<br />
In theory it’s pretty simple. The app needs to:</p>

<ul>
  <li>Get a text message with structured to/from/mode of transportation information</li>
  <li>Pass this to the Google Directions API</li>
  <li>Parse the response</li>
  <li>Return turn-by-turn directions by SMS to the phone</li>
</ul>

<p>As part of my year-long effort to improve my JavaScript skills, I wrote this in Node JS instead of my usual python. It took a little longer, but soon enough I could communicate with the Google API and return directions in a formatted text string:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">stepArr</span> <span class="o">=</span> <span class="p">[]</span>

<span class="kd">var</span> <span class="nx">steps</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">.</span><span class="nx">routes</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">legs</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">steps</span>
<span class="k">for </span><span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">steps</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">step</span> <span class="o">=</span> <span class="nx">steps</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
    <span class="kd">var</span> <span class="nx">instruction</span> <span class="o">=</span> <span class="nx">step</span><span class="p">.</span><span class="nx">html_instructions</span>
    <span class="kd">var</span> <span class="nx">distance</span> <span class="o">=</span> <span class="nx">step</span><span class="p">.</span><span class="nx">distance</span><span class="p">.</span><span class="nx">text</span>

    <span class="kd">var</span> <span class="nx">msg</span> <span class="o">=</span> <span class="nx">instruction</span> <span class="o">+</span> <span class="dl">'</span><span class="s1"> (</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">distance</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">)</span><span class="dl">'</span><span class="p">;</span>
    <span class="nx">stepArr</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="nx">msg</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">return</span> <span class="nx">stepArr</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="dl">'</span><span class="s1">, </span><span class="dl">'</span><span class="p">)</span></code></pre></figure>

<p>Now the hard part– hooking this process up to SMS and AWS. The <a href="http://www.perrygeo.com/running-python-with-compiled-code-on-aws-lambda.html">few things I’d read</a> about deployment suggested it was possible, but involved lots of bundling virtualenvs, handlers, workers in very specific ways so they could be invoked by AWS. <br />
<br />
Luckily I found <a href="https://www.twilio.com/blog/2016/12/create-an-sms-bot-on-aws-lambda-with-claudia-js.html">this awesome tutorial</a> from the SMS service Twilio, which made the process relatively painless. Per their recommendation I wrapped my code using the <a href="https://github.com/claudiajs/claudia-bot-builder">Claudia Bot Builder</a> package, and it took care of the rest, providing an easy CLI interface to package my code and upload it to Lambda.<br />
<br />
The only hard part, per always, my poor understanding of the async nature of JavaScript. I ultimately included calls to OSM’s nominatim geocoder as well, and waiting for responses to come back from that and Google Maps was tough. Once that process was sorted out, and all returned the Promise objects required by claudia.js, deploying was easy.<br />
<br />
I now have an SMS service that can text me directions when I’m lost, am a little bit better at writing JavaScript, and am excited to build more AWS Lambda functions. For those of you with dumbphones, get in touch and I’d be happy to share the phone number and input parameters for the service. For everyone else, check out the code on github to see how easy it is to write a Lambda function: <a href="http://github.com/mappingvermont/navigator">http://github.com/mappingvermont/navigator/</a>.</p>

:ET